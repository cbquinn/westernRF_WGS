Make mappability mask with [[SNPable]]

Before I can run, I need a copy of Heng LI's https://github.com/lh3/misc/tree/master/seq
tools. 
```
cd ~bin
git clone https://github.com/lh3/misc.git
cd ~/bin/misc/seq/seqbility
make
```
This puts the directory of seq at  `~/bin/misc/seq/seqbility`, which I need to point to in my script

To create mappability mask, borrowed  script from Renaud github: https://github.com/grenaud/mappability_snpable/blob/main/snpable.bash. But modified to use a kmer length of 50 and a stringency of 0.5, following [[Tian et al 2022]] 



/group/ctbrowngrp2/cbquinn/fox4/slurmscripts/0.0_make_mappability_mask_snpable.sh
```
#!/bin/bash -l
#SBATCH --job-name=snpable
#SBATCH --nodes 1
#SBATCH --ntasks 8
#SBATCH --time 10-00:00:00
#SBATCH --mem=8GB
#SBATCH -p bmm
#SBATCH -A ctbrowngrp
#SBATCH -o /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/make_mappability_mask_snpable.out
#SBATCH -e /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/make_mappability_mask_snpable.err

cd /group/ctbrowngrp2/cbquinn/fox4/ref/GCF_018345385.1/
REF=GCF_018345385.1_ASM1834538v1_genomic.fna
DIRSEQBILITY=~/bin/misc/seq/seqbility
K=100

module load bwa/0.7.17
module load bedtools2/2.30.0
module load samtools/1.14

bwa aln -t 8 -R 1000000 -O 3 -E 3 $REF <($DIRSEQBILITY/splitfa $REF $K ) | bwa samse $REF /dev/stdin <($DIRSEQBILITY/splitfa $REF $K ) | $DIRSEQBILITY/gen_raw_mask.pl | gzip > rawMask_${K}.fa.gz

$DIRSEQBILITY/gen_mask -l $K -r 0.5 <(zcat rawMask_${K}.fa.gz ) | $DIRSEQBILITY/apply_mask_l /dev/stdin <(cat $REF | awk '{ for(i=1;i<$2;i++){ print $1"\t"i;} }') | awk '{print $1"\t"($2-1)"\t"$2}' | bedtools merge | bgzip -c > arctic_mappable_50.bed.gz

tabix -p bed arctic_mappable_50.bed.gz

```

having trouble with the script above. as insurance, maybe should run 
[[GEM]] or [[genmap]]

### Alternate approach: use genmap 

adapted from Sam's script. She executed as an array, per chr. However, I believe that would only find repetive/uinqiue regions WITHIN a single chr. But repetive elements probably cross genomes.  So changed to run for whole genome

/group/ctbrowngrp2/cbquinn/fox4/slurmscripts/0.0_make_mappability_mask_gem.sh
```
#!/bin/bash -l
#SBATCH --job-name=gem
#SBATCH --nodes 1
#SBATCH --ntasks 8
#SBATCH --time 10-00:00:00
#SBATCH --mem=64GB
#SBATCH -p bmm
#SBATCH -A ctbrowngrp
#SBATCH -o /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/make_mappability_mask_gem.out
#SBATCH -e /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/make_mappability_mask_gem.err

# make things fail on errors
set -o nounset
set -o errexit

dir="/group/ctbrowngrp2/cbquinn/fox4/ref/GCF_018345385.1"
ref="${dir}/GCF_018345385.1_ASM1834538v1_genomic.fna"
out="$dir/genmap/artic"
scaff=GCF_018345385.1_ASM1834538v1_genomic
autosomes=/group/ctbrowngrp2/cbquinn/fox4/ref/GCF_018345385.1/autosomes.bed

start=`date +%s`
echo $HOSTNAME

module load bedtools2
module load repeatmasker
conda activate genmap

# echo "Indexing fasta..."
genmap index -S 45 -F $ref -I $out

#echo "computing mapability..."
genmap map -K 100 -E 2 -I ${out} -O ${out} -bg

#echo "Finding repeat regions..."

RepeatMasker -noint $ref -dir ${out}

#echo "Combining results into single bed file..."

# convert RepeatMasker output into bed file
#tail -n +4 ${out}/${scaff}.fa.out | sed -E 's/.+(SUPER__.+)/\1/' | #sed -E 's/\s+/\t/g' | awk '{print $1"\t"$2-1"\t"$3-1}' > ${out}/${scaff}_repeat_mask.bed

# convert genmap mappability output into bed file
awk '{if ($4 != 1) print $0}' ${out}/${scaff}.genmap.bedgraph > ${out}/${scaff}_E2_low_mapability_mask.bed

# convert genmap mappability mask to good scores to keep
bedtools intersect \
	-a ${out}/${scaff}_E2_low_mapability_mask.bed \
	-b $autosomes \
	-wa | \
bedtools complement \
	-i stdin \
	-g <(cut -f1,3 $autosomes) > ${out}/${scaff}_E2_high_mapability_mask.bed

# combine overlapping regions within and between bed files
cat ${out}/${scaff}_repeat_mask.bed ${out}/${scaff}_E2_low_mapability_mask.bed | sort -k2,2g | bedtools merge -d 150 > ${out}/${scaff}_E2_mask.bed

end=`date +%s`
runtime=$((end-start))
echo "RUNTIME: $runtime"
```



awk '{if ($4 == 1) print $0}' GCF_018345385.1_ASM1834538v1_genomic.genmap.bedgraph | less