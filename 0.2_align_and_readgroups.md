Create paired list
```
cd /group/ctbrowngrp3/scratch/cbquinn/fox/fastqs/trimmed/split/
paste \
    <(ls *.R1*.fastq.gz) \
    <(ls *.R2*.fastq.gz) \
    <(ls *.R1*.fastq.gz | sed 's/.fastq.gz//g') \
    <(ls *.R1*.fastq.gz | sed 's/\.R1.*//g') > /group/ctbrowngrp3/scratch/cbquinn/fox/fastqs/trimmed/split/splitfastqlist_parta.txt
```
I made a separate one for run5
```
cd /group/ctbrowngrp3/scratch/cbquinn/fox/fastqs/trimmed/split/
paste \
    <(ls *.R1*.fastq.gz) \
    <(ls *.R2*.fastq.gz) \
    <(ls *.R1*.fastq.gz | sed 's/.fastq.gz//g') \
    <(ls *.R1*.fastq.gz | sed 's/\.R1.*//g') > /group/ctbrowngrp3/scratch/cbquinn/fox/fastqs/trimmed/split/splitfastqlist_run5_parta.txt
```


Add other info in R
```R
# for runs 1-4
library(tidyverse)
parta <- read_tsv("/group/ctbrowngrp3/scratch/cbquinn/fox/fastqs/trimmed/split/splitfastqlist_parta.txt", col_names=c("read1", "read2", "chunk", "BASENAME"))
partb <- read_tsv("/group/ctbrowngrp3/scratch/cbquinn/fox/fastqlist.txt", col_names=c("JOB", "RUN",	"RFID",	"SID",	"BASENAME",	"LIB",	"PLATFORM", "POP")) %>%
select(-JOB)
c <- left_join(parta, partb, by=c("BASENAME")) %>%
	mutate(JOB=1:nrow(parta)) %>%
	relocate(JOB)
c
write_tsv(c, "/group/ctbrowngrp3/scratch/cbquinn/fox/fastqs/trimmed/split/splitfastqlist.txt", col_names=FALSE)

# for run 5
library(tidyverse)
parta <- read_tsv("/group/ctbrowngrp3/scratch/cbquinn/fox/fastqs/trimmed/split/splitfastqlist_run5_parta.txt", col_names=c("read1", "read2", "chunk", "BASENAME"))
partb <- read_tsv("/group/ctbrowngrp3/scratch/cbquinn/fox/fastqlist.txt", col_names=c("JOB", "RUN",	"RFID",	"SID",	"BASENAME",	"LIB",	"PLATFORM", "POP")) %>%
select(-JOB)
c <- left_join(parta, partb, by=c("BASENAME")) %>%
	mutate(JOB=1:nrow(parta)) %>%
	relocate(JOB)
c
write_tsv(c, "/group/ctbrowngrp3/scratch/cbquinn/fox/fastqs/trimmed/split/splitfastqlist_run5.txt", col_names=FALSE)

q()
```

for reference: top lines of LIST
```
JOB read1 read2 chunk BASENAME RUN RFID SID LIB PLATFORM POP
```




Ran this with either :
	LIST=/group/ctbrowngrp3/scratch/cbquinn/fox/fastqs/trimmed/split/splitfastqlist.txt
or
	LIST=/group/ctbrowngrp3/scratch/cbquinn/fox/fastqs/trimmed/split/splitfastqlist_run5.txt
	
For the bottom  (run5) the script was 
`/group/ctbrowngrp2/cbquinn/fox4/slurmscripts/bwamem_run5.sh`
and the out/err files were: `/group/ctbrowngrp2/cbquinn/fox4/slurmlogs/bwamem_run5_%a.out`
And there were 22 jobs


```
#!/bin/bash -l
#SBATCH --job-name=bwa_mod
#SBATCH --array=1-89%25
#SBATCH --nodes 1
#SBATCH --ntasks 1
#SBATCH --time 3-00:00:00
#SBATCH --mem=8GB
#SBATCH -p bmm
#SBATCH -A ctbrowngrp
#SBATCH -o /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/bwamem_%a.out
#SBATCH -e /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/bwamem_%a.err


# make things fail on errors
set -o nounset
set -o errexit

echo "My SLURM_ARRAY_TASK_ID: " $SLURM_ARRAY_TASK_ID

# LIST is a text file with as many rows as there are split fastq chunkks and the following columns: JOB READ1 READ2 CHUNK BASENAME RUN RFID SID LIB PLATFORM POP
# use these to add detailed readgroup info

LIST=/group/ctbrowngrp3/scratch/cbquinn/fox/fastqs/trimmed/split/splitfastqlist.txt
READ1=$(sed "${SLURM_ARRAY_TASK_ID}q;d" $LIST | cut -f2)
READ2=$(sed "${SLURM_ARRAY_TASK_ID}q;d" $LIST | cut -f3)
CHUNK=$(sed "${SLURM_ARRAY_TASK_ID}q;d" $LIST | cut -f4)
BASENAME=$(sed "${SLURM_ARRAY_TASK_ID}q;d" $LIST | cut -f5)
RUN=$(sed "${SLURM_ARRAY_TASK_ID}q;d" $LIST | cut -f6)
RFID=$(sed "${SLURM_ARRAY_TASK_ID}q;d" $LIST | cut -f7)
SID=$(sed "${SLURM_ARRAY_TASK_ID}q;d" $LIST | cut -f8)
LIB=$(sed "${SLURM_ARRAY_TASK_ID}q;d" $LIST | cut -f9)
PLATFORM=$(sed "${SLURM_ARRAY_TASK_ID}q;d" $LIST | cut -f10)
POP=$(sed "${SLURM_ARRAY_TASK_ID}q;d" $LIST | cut -f11)

REF=/group/ctbrowngrp2/cbquinn/fox4/ref/GCF_018345385.1/GCF_018345385.1_ASM1834538v1_genomic.fna
INDIR=/group/ctbrowngrp3/scratch/cbquinn/fox/fastqs/trimmed/split/
OUTDIR=/group/ctbrowngrp3/scratch/cbquinn/fox/bams/

echo "Aligning paired chunk ${CHUNK} to arctic fox reference using bwa-mem"

module load bwa
module load samtools

# Align R1 and R2 
# Pipe to a bam file that excludes bad mapping scores
# Pipe to a sorted bam for merging

cd $OUTDIR
bwa mem ${REF} ${INDIR}${READ1} ${INDIR}${READ2} | \
samtools view -h -b - | \
samtools sort -o ${OUTDIR}chunk/${CHUNK}.bam -

echo "adding readgroups..."
module load picardtools/2.7.1

java -jar ${PICARD}/picard.jar AddOrReplaceReadGroups \
    I=${OUTDIR}chunk/${CHUNK}.bam \
    O=${OUTDIR}chunk/readgroups/${CHUNK}.bam \
    RGID=${RUN} RGLB=${LIB} RGPL=${PLATFORM} RGPU=NULL RGSM=${RFID}_${SID} \
    VALIDATION_STRINGENCY=LENIENT

# remove raw output bam
rm ${OUTDIR}chunk/${CHUNK}.bam
```

### fix swapped fastq names
ORC_S18-2071_run4 & WAC_S10-0583_run4 are swapped. Correct sample names here:

```
cd /group/ctbrowngrp3/scratch/cbquinn/fox/bams/chunk/readgroups
mv ORC_S18-2068_run4.R10000.bam tempWAC1.bam
mv ORC_S18-2068_run4.R10001.bam tempWAC2.bam
mv WAC_S10-0583_run4.R10000.bam tempORC1.bam
mv WAC_S10-0583_run4.R10001.bam tempORC2.bam
mv tempWAC1.bam WAC_S10-0583_run4.R10000.bam
mv tempWAC2.bam WAC_S10-0583_run4.R10001.bam
mv tempORC1.bam ORC_S18-2068_run4.R10000.bam
mv tempORC2.bam ORC_S18-2068_run4.R10001.bam
```

ack!!! I got this totally wrong for Oregon... the swapped one was S17-2543_RF16 (ORC_S17-2543).  

currentname | old name | action | new name (correct identity)
--- | --- | --- | ---
WAC_S10-0583_run4.R10000.bam | ORC_S18-2068_run4.R10000.bam | needs to get turned back to old name | ORC_S18-2068_run4.R10000.bam 
WAC_S10-0583_run4.R10001.bam | ORC_S18-2068_run4.R10001.bam | needs to get turned back to old name | ORC_S18-2068_run4.R10000.bam
ORC_S18-2068_run4.R10000.bam | WAC_S10-0583_run4.R10000.bam | needs to get turned into ORC_S17-2543 | ORC_S17-2543_run4.R10000.bam
ORC_S18-2068_run4.R10001.bam |  WAC_S10-0583_run4.R10001.bam | needs to get turned into ORC_S17-2543 | ORC_S17-2543_run4.R10001.bam
ORC_S17-2543_run4.R10000.bam | same | needs to get turned into WAC | WAC_S10-0583_run4.R10000.bam
ORC_S17-2543_run4.R10001.bam | same | needs to get turned into WAC | WAC_S10-0583_run4.R10001.bam

```
cd /group/ctbrowngrp3/scratch/cbquinn/fox/bams/chunk/readgroups
mv WAC_S10-0583_run4.R10000.bam ORC_S18-2068_run4.R10000.BAM
mv WAC_S10-0583_run4.R10001.bam ORC_S18-2068_run4.R10000.BAM
mv ORC_S18-2068_run4.R10000.bam ORC_S17-2543_run4.R10000.BAM
mv ORC_S18-2068_run4.R10001.bam ORC_S17-2543_run4.R10001.BAM
mv ORC_S17-2543_run4.R10000.bam WAC_S10-0583_run4.R10000.BAM
mv ORC_S17-2543_run4.R10001.bam WAC_S10-0583_run4.R10001.BAM

mv ORC_S18-2068_run4.R10000.BAM ORC_S18-2068_run4.R10000.bam
mv ORC_S18-2068_run4.R10000.BAM ORC_S18-2068_run4.R10000.bam
mv ORC_S17-2543_run4.R10000.BAM ORC_S17-2543_run4.R10000.bam
mv ORC_S17-2543_run4.R10001.BAM ORC_S17-2543_run4.R10001.bam
mv WAC_S10-0583_run4.R10000.BAM WAC_S10-0583_run4.R10000.bam
mv WAC_S10-0583_run4.R10001.BAM WAC_S10-0583_run4.R10001.bam
```

Next, need to rerun bam cleaning for 2543, 2068, 0583: job arrays 13,17, 30 