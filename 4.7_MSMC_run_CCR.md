
/group/ctbrowngrp2/cbquinn/fox4/slurmscripts/msmc2_run_phased_CCR.sh

/group/ctbrowngrp2/cbquinn/fox4/slurmscripts/msmc2_run_phased_CCR_temp1.sh
```
#!/bin/bash -l
#SBATCH --job-name=CCR
#SBATCH --ntasks=1
#SBATCH --cpus-per-task=16
#SBATCH --time 8-00:00:00
#SBATCH --mem=165GB
#SBATCH -p bmm
#SBATCH -A ctbrowngrp
#SBATCH -o /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/msmc2_run_phased_CCR.out
#SBATCH -e /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/msmc2_run_phased_CCR.err

# fail on errors and don't allow unset variables
set –o pipefail
set –o errexit
set –o nounset
set -e

INDIR=/group/ctbrowngrp2/cbquinn/fox4/4_SMC/MSMC2/inputs/phased
OUTDIR=/group/ctbrowngrp2/cbquinn/fox4/4_SMC/MSMC2/outputs/phased

conda activate msmc2

# get list of chr files
INPUTS=$(find $INDIR/all10_*_msmc.txt | paste -sd " ")

p="10*1+22*2+1*4+1*6"
# old: p="1*10+22*2+4*1+6*1"
dir="t20_10x1_22x2_1x4_1x6"

# estimate cross-coalescence
# the -s flag tells MSMC to skip sites with ambiguous phasing. unphased sites are not so much of a problem for Ne but for cross-population analysis recommended to remove them

# LAS_EAST ccr
msmc2 -t 16 -i 20 -p $p -s -I 0-16,0-17,0-18,0-19,1-16,1-17,1-18,1-19,2-16,2-17,2-18,2-19,3-16,3-17,3-18,3-19 -o ${OUTDIR}/$dir/LAS_EAST_msmc.out $INPUTS

# ORC_EAST ccr
msmc2 -t 16 -i 20 -p $p -s -I 4-16,4-17,4-18,4-19,5-16,5-17,5-18,5-19,6-16,6-17,6-18,6-19,7-16,7-17,7-18,7-19 -o ${OUTDIR}/$dir/ORC_EAST_cross_msmc.out $INPUTS

# RM_EAST ccr
msmc2 -t 16 -i 20 -p $p -s -I 8-16,8-17,8-18,8-19,9-16,9-17,9-18,9-19,10-16,10-17,10-18,10-19,11-16,11-17,11-18,11-19 -o ${OUTDIR}/$dir/RM_EAST_cross_msmc.out $INPUTS

# WAC_EAST ccr
msmc2 -t 16 -i 20 -p $p -s -I 12-16,12-17,12-18,12-19,13-16,13-17,13-18,13-19,14-16,14-17,14-18,14-19,15-16,15-17,15-18,15-19 -o ${OUTDIR}/$dir/WAC_EAST_cross_msmc.out $INPUTS

# LAS_ORC ccr
msmc2 -t 16 -i 20 -p $p -s -I 0-4,0-5,0-6,0-7,1-4,1-5,1-6,1-7,2-4,2-5,2-6,2-7,3-4,3-5,3-6,3-7 -o ${OUTDIR}/$dir/LAS_ORC_cross_msmc.out $INPUTS

# LAS_RM ccr
msmc2 -t 16 -i 20 -p $p -s -I 0-8,0-9,0-10,0-11,1-8,1-9,1-10,1-11,2-8,2-9,2-10,2-11,3-8,3-9,3-10,3-11 -o ${OUTDIR}/$dir/LAS_RM_cross_msmc.out $INPUTS

# LAS_WAC ccr
msmc2 -t 16 -i 20 -p $p -s -I 0-12,0-13,0-14,0-15,1-12,1-13,1-14,1-15,2-12,2-13,2-14,2-15,3-12,3-13,3-14,3-15 -o ${OUTDIR}/$dir/LAS_WAC_cross_msmc.out $INPUTS

# ORC_RM ccr
msmc2 -t 16 -i 20 -p $p -s -I 4-8,4-9,4-10,4-11,5-8,5-9,5-10,5-11,6-8,6-9,6-10,6-11,7-8,7-9,7-10,7-11 -o ${OUTDIR}/$dir/ORC_RM_cross_msmc.out $INPUTS

# ORC_WAC ccr
msmc2 -t 16 -i 20 -p $p -s -I 4-12,4-13,4-14,4-15,5-12,5-13,5-14,5-15,6-12,6-13,6-14,6-15,7-12,7-13,7-14,7-15 -o ${OUTDIR}/$dir/ORC_WAC_cross_msmc.out $INPUTS

# WAC_RM ccr
msmc2 -t 16 -i 20 -p $p -s -I 12-8,12-9,12-10,12-11,13-8,13-9,13-10,13-11,14-8,14-9,14-10,14-11,15-8,15-9,15-10,15-11 -o ${OUTDIR}/$dir/ORC_RM_cross_msmc.out $INPUTS

~/bin/msmc-tools/combineCrossCoal.py ${OUTDIR}/$dir/LAS_msmc.out.final.txt ${OUTDIR}/$dir/ORC_msmc.out.final.txt ${OUTDIR}/$dir/RM_msmc.out.final.txt ${OUTDIR}/$dir/WAC_msmc.out.final.txt ${OUTDIR}/$dir/EAST_msmc.out.final.txt > ${OUTDIR}/$dir/MSMC2_phased_Ne_combined.out

~/bin/msmc-tools/combineCrossCoal.py ${OUTDIR}/$dir/*cross_msmc.out > ${OUTDIR}/$dir/MSMC2_phased_cross_combined.out

# Print out final statistics about resource use before job exits
scontrol show job ${SLURM_JOB_ID}
sstat --format 'JobID,MaxRSS,AveCPU' -P ${SLURM_JOB_ID}.batch

```

/group/ctbrowngrp2/cbquinn/fox4/slurmscripts/msmc2_run_phased_CCR_nos.sh
```
#!/bin/bash -l
#SBATCH --job-name=CCR
#SBATCH --ntasks=1 
#SBATCH --cpus-per-task=16
#SBATCH --time 8-00:00:00
#SBATCH --mem=165GB
#SBATCH -p bmm
#SBATCH -A ctbrowngrp
#SBATCH -o /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/msmc2_run_phased_CCR.out
#SBATCH -e /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/msmc2_run_phased_CCR.err

# fail on errors and don't allow unset variables
set –o pipefail
set –o errexit
set –o nounset
set -e

INDIR=/group/ctbrowngrp2/cbquinn/fox4/4_SMC/MSMC2/inputs/phased
OUTDIR=/group/ctbrowngrp2/cbquinn/fox4/4_SMC/MSMC2/outputs/phased

conda activate msmc2

# get list of chr files
INPUTS=$(find $INDIR/all10_*_msmc.txt | paste -sd " ")

p="10*1+22*2+1*4+1*6"
dir="t20_10x1_22x2_1x4_1x6"

# estimate cross-coalescence
# the -s flag tells MSMC to skip sites with ambiguous phasing. unphased sites are not so much of a problem for Ne but for cross-population analysis recommended to remove them

# LAS_EAST ccr
msmc2 -t 16 -i 20 -p $p -s -I 0-16,0-17,0-18,0-19,1-16,1-17,1-18,1-19,2-16,2-17,2-18,2-19,3-16,3-17,3-18,3-19 -o ${OUTDIR}/$dir/nos/LAS_EAST_msmc.out $INPUTS

# ORC_EAST ccr
msmc2 -t 16 -i 20 -p $p -s -I 4-16,4-17,4-18,4-19,5-16,5-17,5-18,5-19,6-16,6-17,6-18,6-19,7-16,7-17,7-18,7-19 -o ${OUTDIR}/$dir/nos/ORC_EAST_cross_msmc.out $INPUTS

# RM_EAST ccr
msmc2 -t 16 -i 20 -p $p -s -I 8-16,8-17,8-18,8-19,9-16,9-17,9-18,9-19,10-16,10-17,10-18,10-19,11-16,11-17,11-18,11-19 -o ${OUTDIR}/$dir/nos/RM_EAST_cross_msmc.out $INPUTS

# WAC_EAST ccr
msmc2 -t 16 -i 20 -p $p -s -I 12-16,12-17,12-18,12-19,13-16,13-17,13-18,13-19,14-16,14-17,14-18,14-19,15-16,15-17,15-18,15-19 -o ${OUTDIR}/$dir/nos/WAC_EAST_cross_msmc.out $INPUTS

# LAS_ORC ccr
msmc2 -t 16 -i 20 -p $p -s -I 0-4,0-5,0-6,0-7,1-4,1-5,1-6,1-7,2-4,2-5,2-6,2-7,3-4,3-5,3-6,3-7 -o ${OUTDIR}/$dir/nos/LAS_ORC_cross_msmc.out $INPUTS

# LAS_RM ccr
msmc2 -t 16 -i 20 -p $p -s -I 0-8,0-9,0-10,0-11,1-8,1-9,1-10,1-11,2-8,2-9,2-10,2-11,3-8,3-9,3-10,3-11 -o ${OUTDIR}/$dir/nos/LAS_RM_cross_msmc.out $INPUTS

# LAS_WAC ccr
msmc2 -t 16 -i 20 -p $p -s -I 0-12,0-13,0-14,0-15,1-12,1-13,1-14,1-15,2-12,2-13,2-14,2-15,3-12,3-13,3-14,3-15 -o ${OUTDIR}/$dir/nos/LAS_WAC_cross_msmc.out $INPUTS

# ORC_RM ccr
msmc2 -t 16 -i 20 -p $p -s -I 4-8,4-9,4-10,4-11,5-8,5-9,5-10,5-11,6-8,6-9,6-10,6-11,7-8,7-9,7-10,7-11 -o ${OUTDIR}/$dir/nos/ORC_RM_cross_msmc.out $INPUTS

# ORC_WAC ccr
msmc2 -t 16 -i 20 -p $p -s -I 4-12,4-13,4-14,4-15,5-12,5-13,5-14,5-15,6-12,6-13,6-14,6-15,7-12,7-13,7-14,7-15 -o ${OUTDIR}/$dir/nos/ORC_WAC_cross_msmc.out $INPUTS

# WAC_RM ccr
msmc2 -t 16 -i 20 -p $p -s -I 12-8,12-9,12-10,12-11,13-8,13-9,13-10,13-11,14-8,14-9,14-10,14-11,15-8,15-9,15-10,15-11 -o ${OUTDIR}/$dir/nos/ORC_RM_cross_msmc.out $INPUTS


# Print out final statistics about resource use before job exits
scontrol show job ${SLURM_JOB_ID}
sstat --format 'JobID,MaxRSS,AveCPU' -P ${SLURM_JOB_ID}.batch
```

Cross with -s option
```
~/bin/msmc-tools/combineCrossCoal.py LAS_EAST_msmc.out.final.txt LAS_msmc.out.final.txt EAST_msmc.out.final.txt > LAS_EAST_msmc.combined.final.txt

~/bin/msmc-tools/combineCrossCoal.py ORC_EAST_cross_msmc.out.final.txt ORC_msmc.out.final.txt EAST_msmc.out.final.txt > ORC_EAST_msmc.combined.final.txt

~/bin/msmc-tools/combineCrossCoal.py RM_EAST_cross_msmc.out.final.txt RM_msmc.out.final.txt EAST_msmc.out.final.txt > RM_EAST_msmc.combined.final.txt

~/bin/msmc-tools/combineCrossCoal.py WAC_EAST_cross_msmc.out.final.txt RM_msmc.out.final.txt EAST_msmc.out.final.txt > WAC_EAST_msmc.combined.final.txt

~/bin/msmc-tools/combineCrossCoal.py LAS_ORC_cross_msmc.out.final.txt LAS_msmc.out.final.txt ORC_msmc.out.final.txt > LAS_ORC_msmc.combined.final.txt

~/bin/msmc-tools/combineCrossCoal.py LAS_RM_cross_msmc.out.final.txt LAS_msmc.out.final.txt RM_msmc.out.final.txt > LAS_RM_msmc.combined.final.txt

~/bin/msmc-tools/combineCrossCoal.py LAS_WAC_cross_msmc.out.final.txt LAS_msmc.out.final.txt WAC_msmc.out.final.txt > LAS_WAC_msmc.combined.final.txt

~/bin/msmc-tools/combineCrossCoal.py ORC_RM_cross_msmc.out.final.txt ORC_msmc.out.final.txt RM_msmc.out.final.txt > ORC_RM_msmc.combined.final.txt

~/bin/msmc-tools/combineCrossCoal.py ORC_WAC_cross_msmc.out.final.txt ORC_msmc.out.final.txt WAC_msmc.out.final.txt > ORC_WAC_msmc.combined.final.txt

~/bin/msmc-tools/combineCrossCoal.py WAC_RM_cross_msmc.out.final.txt WAC_msmc.out.final.txt RM_msmc.out.final.txt > WAC_RM_msmc.combined.final.txt


```


Cross without -s option (NOS)
```
cd /group/ctbrowngrp2/cbquinn/fox4/4_SMC/MSMC2/outputs/phased/t20_10x1_22x2_1x4_1x6

~/bin/msmc-tools/combineCrossCoal.py nos/LAS_EAST_msmc.out.final.txt LAS_msmc.out.final.txt EAST_msmc.out.final.txt > nos/LAS_EAST_msmc.combined.final.txt

~/bin/msmc-tools/combineCrossCoal.py nos/ORC_EAST_cross_msmc.out.final.txt ORC_msmc.out.final.txt EAST_msmc.out.final.txt > nos/ORC_EAST_msmc.combined.final.txt

~/bin/msmc-tools/combineCrossCoal.py RM_EAST_cross_msmc.out.final.txt RM_msmc.out.final.txt EAST_msmc.out.final.txt > RM_EAST_msmc.combined.final.txt

~/bin/msmc-tools/combineCrossCoal.py WAC_EAST_cross_msmc.out.final.txt RM_msmc.out.final.txt EAST_msmc.out.final.txt > WAC_EAST_msmc.combined.final.txt

~/bin/msmc-tools/combineCrossCoal.py LAS_ORC_cross_msmc.out.final.txt LAS_msmc.out.final.txt ORC_msmc.out.final.txt > LAS_ORC_msmc.combined.final.txt

~/bin/msmc-tools/combineCrossCoal.py nos/LAS_RM_cross_msmc.out.final.txt LAS_msmc.out.final.txt RM_msmc.out.final.txt > nos/LAS_RM_msmc.combined.final.txt

~/bin/msmc-tools/combineCrossCoal.py nos/LAS_WAC_cross_msmc.out.final.txt LAS_msmc.out.final.txt WAC_msmc.out.final.txt > nos/LAS_WAC_msmc.combined.final.txt
