
### Setup 
Julia has downloaded version here: /group/ctbrowngrp2/jdowen/bin/GONE-master/Linux/script_GONE.sh

copy it to my bin filed
`cp -r /group/ctbrowngrp2/jdowen/bin/GONE-master/Linux/ ~/bin/`

create a second copy for being able to run 2 replicates at a time
cp -r ~/bin/Linux ~/bin/GONE_cp2


new location is: ~/bin/Linux/script_GONE.sh

### Create plink input files

/group/ctbrowngrp2/cbquinn/fox4/slurmscripts/make_gone_inputs.sh
```sh
#!/bin/bash -l
#SBATCH --job-name=gone_in
#SBATCH --time 24:00:00
#SBATCH --mem=6GB
#SBATCH -p bmm
#SBATCH -A ctbrowngrp
#SBATCH -o /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/make_gone_inputs.out
#SBATCH -e /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/make_gone_inputs.err

OUTDIR=/group/ctbrowngrp2/cbquinn/fox4/7_GONE/inputs

VCF=/group/ctbrowngrp2/cbquinn/fox4/1_vcfs/variant/n34/bcf_variant_filterA_ac1.dp3.mis20_n34_masked.vcf.gz
CHR_MAP=/group/ctbrowngrp2/cbquinn/fox4/ref/GCF_018345385.1/chrmap_numeric.tsv


module load deprecated/plink/1.90
module load bcftools
module load vcftools/0.1.14

~/bin/Linux/

for pop in LAS ORC WAC RM
do

# filter by pop and remove monomorphic sites
# rename chromosomes to be numeric
bcftools query -l $VCF | grep "$pop" > ${pop}.names.txt
bcftools view -S ${pop}.names.txt $VCF | \
bcftools view -c 1:minor -Oz | \
vcftools --gzvcf - --chrom-map $CHR_MAP --plink --out ${pop}_filterA

# create plink files 
# (set-missing-var-ids is necessary or it produces a snp list filled with ".")
plink --file ${pop}_filterA \
    --allow-extra-chr \
    --chr-set 24 \
    --set-missing-var-ids @:# \
    --keep-allele-order \
    --recode \
    --out ${pop}_filterA
done

# do east separately - made names file by hand
pop=EAST
bcftools view -S ${pop}.names.txt $VCF | \
bcftools view -c 1:minor -Oz | \
vcftools --gzvcf - --chrom-map $CHR_MAP --plink --out ${pop}_filterA

# create plink files
plink --file ${pop}_filterA \
    --allow-extra-chr \
    --chr-set 24 \
    --set-missing-var-ids @:# \
    --keep-allele-order \
    --recode \
    --out ${pop}_filterA

# make a subset of all western
cat LAS.names.txt ORC.names.txt WAC.names.txt RM.names.txt > WEST.names.txt

pop=WEST
bcftools view -S ${pop}.names.txt $VCF | \
bcftools view -c 1:minor -Oz | \
vcftools --gzvcf - --chrom-map $CHR_MAP --plink --out ${pop}_filterA

# create plink files
plink --file ${pop}_filterA \
    --allow-extra-chr \
    --chr-set 24 \
    --set-missing-var-ids @:# \
    --keep-allele-order \
    --recode \
    --out ${pop}_filterA

# make a few subsets
# ORC without admixed individuals: ORC_7

ORC_S17-2543
ORC_S17-2544
ORC_S18-1173
ORC_S18-2062
ORC_S18-2068
ORC_S18-2069
ORC_S18-2071

plink --file ORC_filterA \
    --keep ORC_7.names.txt \
    --maf 0.01 \
    --recode \
    --out ORC7_filterA

# RM without NV
RM_S13-0649
RM_S13-2269
RM_S18-2063
RM_S13-1169
RM_S13-2260

plink --file RM_filterA \
    --keep RM5.names.txt \
    --maf 0.01 \
    --recode \
    --out RM5_filterA



```


### Parameter file

~/bin/INPUT_PARAMETERS_FILE
kept defaults except for 
```
cMMb=0.6
Threads=12
```

/group/ctbrowngrp2/cbquinn/fox4/slurmscripts/temp2.sh
```
cd ~/bin/Linux/
for pop in LAS ORC WAC RM EAST
do 
sbatch ./script_GONE.sh /group/ctbrowngrp2/cbquinn/fox4/7_GONE/inputs/${pop}_filterA &> /group/ctbrowngrp2/cbquinn/fox4/7_GONE/outputs/${pop}_GONE.log
done


cd /group/ctbrowngrp2/cbquinn/fox4/7_GONE/inputs/
sbatch ~/bin/Linux/script_GONE.sh ${pop}_filterA


cp /group/ctbrowngrp2/cbquinn/fox4/7_GONE/inputs/WEST*ped ~/bin/Linux/ 
cp /group/ctbrowngrp2/cbquinn/fox4/7_GONE/inputs/WEST*map ~/bin/Linux/

cd ~/bin/Linux/
sbatch ./script_GONE.sh WEST_filterA

```

I ad to move files because of disk quota
```
rsync -av ~/bin/GONE_cp1 /group/ctbrowngrp3/scratch/cbquinn/fox/

rsync -av ~/bin/GONE_cp2 /group/ctbrowngrp3/scratch/cbquinn/fox/

rm -r ~/bin/GONE_cp*

# chmod for srun 
chmod +x /group/ctbrowngrp3/scratch/cbquinn/fox/GONE_cp1/script_GONE.sh
chmod +x /group/ctbrowngrp3/scratch/cbquinn/fox/GONE_cp2/script_GONE.sh
```

### Set up loop to run replicates
/group/ctbrowngrp2/cbquinn/fox4/slurmscripts/run_gone_west.sh
```
#!/bin/bash -l
#SBATCH --job-name=west
#SBATCH --time 8-00:00:00
#SBATCH --cpus-per-task 12
#SBATCH --mem=8GB
#SBATCH -p bmm
#SBATCH -A ctbrowngrp
#SBATCH -o /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/run_gone_west.out
#SBATCH -e /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/run_gone_west.err


# randomly select 20 western individuals
# remove monomorphic sites

module load deprecated/plink/1.90

cd /group/ctbrowngrp3/scratch/cbquinn/fox/GONE_cp1

i=1

echo "$i"
shuf -n 20 /group/ctbrowngrp2/cbquinn/fox4/7_GONE/inputs/WEST.names.txt > temp.names.i${i}.text

paste temp.names.i${i}.text temp.names.i${i}.text > WEST.names.i${i}.text

plink --file WEST_filterA \
    --keep WEST.names.i${i}.text \
    --maf 0.01 \
    --recode \
    --out WEST_filterA_i${i}

# submit and get jobID
JOBID=$(srun script_GONE.sh WEST_filterA_i${i} | awk '{print $4}')

while [ $i -le 20 ]
do
        i=$(($i+1))

echo "$i"
		
shuf -n 20 /group/ctbrowngrp2/cbquinn/fox4/7_GONE/inputs/WEST.names.txt > temp.names.i${i}.text

paste temp.names.i${i}.text temp.names.i${i}.text > WEST.names.i${i}.text

plink --file WEST_filterA \
    --keep WEST.names.i${i}.text \
    --maf 0.01 \
    --recode \
    --out WEST_filterA_i${i}

# make script dependent on the previous
JOBID=$(srun -d afterok:$JOBID script_GONE.sh WEST_filterA_i${i} | awk '{print $4}')

done
```


/group/ctbrowngrp2/cbquinn/fox4/slurmscripts/run_gone_east.sh
```
#!/bin/bash -l
#SBATCH --job-name=east
#SBATCH --time 6-00:00:00
#SBATCH --cpus-per-task 12
#SBATCH --mem=8GB
#SBATCH -p bmm
#SBATCH -A ctbrowngrp
#SBATCH -o /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/run_gone_east.out
#SBATCH -e /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/run_gone_east.err


# run replicates of the east

module load deprecated/plink/1.90

cd /group/ctbrowngrp3/scratch/cbquinn/fox/GONE_cp2

i=1

echo "$i"

cp EAST_filterA.ped EAST_filterA_i${i}.ped
cp EAST_filterA.map EAST_filterA_i${i}.map

# submit and get jobID
JOBID=$(srun script_GONE.sh EAST_filterA_i${i} | awk '{print $4}')

while [ $i -le 20 ]
do
        
        i=$(($i+1))
		#((i++))
	        echo "$i"

cp EAST_filterA.ped EAST_filterA_i${i}.ped
cp EAST_filterA.map EAST_filterA_i${i}.map

# make script dependent on the previous
JOBID=$(srun -d afterok:$JOBID script_GONE.sh EAST_filterA_i${i} | awk '{print $4}')

done

rm EAST_filterA_i*ped
rm EAST_filterA_i*map
```


/group/ctbrowngrp2/cbquinn/fox4/slurmscripts/run_gone_RM.sh
```
#!/bin/bash -l
#SBATCH --job-name=east
#SBATCH --time 6-00:00:00
#SBATCH --cpus-per-task 12
#SBATCH --mem=8GB
#SBATCH -p bmm
#SBATCH -A ctbrowngrp
#SBATCH -o /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/run_gone_east.out
#SBATCH -e /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/run_gone_east.err


# run replicates of the RM (all ind except NV )

module load deprecated/plink/1.90

cd /group/ctbrowngrp3/scratch/cbquinn/fox/GONE_cp2

i=21

echo "$i"

cp EAST_filterA.ped EAST_filterA_i${i}.ped
cp EAST_filterA.map EAST_filterA_i${i}.map

# submit and get jobID
JOBID=$(srun script_GONE.sh EAST_filterA_i${i} | awk '{print $4}')

while [ $i -le 40 ]
do
        i=$(($i+1))
        echo "$i"

cp EAST_filterA.ped EAST_filterA_i${i}.ped
cp EAST_filterA.map EAST_filterA_i${i}.map

# make script dependent on the previous
JOBID=$(srun -d afterok:$JOBID script_GONE.sh EAST_filterA_i${i} | awk '{print $4}')

done

rm EAST_filterA_i*ped
rm EAST_filterA_i*map
```

/group/ctbrowngrp2/cbquinn/fox4/slurmscripts/run_gone_RM6.sh
```
#!/bin/bash -l
#SBATCH --job-name=RM
#SBATCH --time 6-00:00:00
#SBATCH --cpus-per-task 12
#SBATCH --mem=8GB
#SBATCH -p bmm
#SBATCH -A ctbrowngrp
#SBATCH -o /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/run_gone_RM6.out
#SBATCH -e /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/run_gone_RM6.err


# run replicates of the RM (all ind except NV 3312)

module load deprecated/plink/1.90

cd /group/ctbrowngrp3/scratch/cbquinn/fox/GONE_cp2

plink --file RM_filterA \
    --keep /group/ctbrowngrp2/cbquinn/fox4/7_GONE/inputs/RM6.names.txt \
    --maf 0.01 \
    --recode \
    --out RM6_filterA
    
i=1
echo "$i"

# submit and get jobID
JOBID=$(srun script_GONE.sh RM6_filterA | awk '{print $4}')

while [ $i -le 20 ]
do

        echo "$i"

cp RM6_filterA.ped RM6_filterA_i${i}.ped
cp RM6_filterA.map RM6_filterA_i${i}.map

# make script dependent on the previous
JOBID=$(srun -d afterok:$JOBID script_GONE.sh RM6_filterA_i${i} | awk '{print $4}')

i=$(($i+1))
done

rm RM6_filterA_i*ped
rm RM6_filterA_i*map
```

/group/ctbrowngrp2/cbquinn/fox4/slurmscripts/run_gone_LAS.sh
```
#!/bin/bash -l
#SBATCH --job-name=LAS
#SBATCH --time 6-00:00:00
#SBATCH --cpus-per-task 12
#SBATCH --mem=8GB
#SBATCH -p bmm
#SBATCH -A ctbrowngrp
#SBATCH -o /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/run_gone_LAS.out
#SBATCH -e /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/run_gone_LAS.err


# run replicates of the LAS

module load deprecated/plink/1.90

cd /group/ctbrowngrp3/scratch/cbquinn/fox/GONE_cp1
    
i=1
echo "$i"

# submit and get jobID
JOBID=$(srun script_GONE.sh LAS_filterA | awk '{print $4}')

while [ $i -le 42 ]
do

        echo "$i"

cp LAS_filterA.ped LAS_filterA_i${i}.ped
cp LAS_filterA.map LAS_filterA_i${i}.map

# make script dependent on the previous
JOBID=$(srun -d afterok:$JOBID script_GONE.sh LAS_filterA_i${i} | awk '{print $4}')

i=$(($i+1))
done

rm LAS_filterA_i*ped
rm LAS_filterA_i*map

```

/group/ctbrowngrp2/cbquinn/fox4/slurmscripts/run_gone_WAC.sh
```
#!/bin/bash -l
#SBATCH --job-name=LAS
#SBATCH --time 6-00:00:00
#SBATCH --cpus-per-task 12
#SBATCH --mem=8GB
#SBATCH -p bmm
#SBATCH -A ctbrowngrp
#SBATCH -o /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/run_gone_WAC.out
#SBATCH -e /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/run_gone_WAC.err


# run replicates of the WAC

module load deprecated/plink/1.90

cd /group/ctbrowngrp3/scratch/cbquinn/fox/GONE_cp1
    
i=1
echo "$i"

# submit and get jobID
JOBID=$(srun script_GONE.sh WAC_filterA | awk '{print $4}')

while [ $i -le 42 ]
do

        echo "$i"

cp WAC_filterA.ped WAC_filterA_i${i}.ped
cp WAC_filterA.map WAC_filterA_i${i}.map

# make script dependent on the previous
JOBID=$(srun -d afterok:$JOBID script_GONE.sh WAC_filterA_i${i} | awk '{print $4}')

i=$(($i+1))
done

rm WAC_filterA_i*ped
rm WAC_filterA_i*map
```

/group/ctbrowngrp2/cbquinn/fox4/slurmscripts/run_gone_ORC7.sh
```sh
#!/bin/bash -l
#SBATCH --job-name=ORC7
#SBATCH --time 6-00:00:00
#SBATCH --cpus-per-task 12
#SBATCH --mem=8GB
#SBATCH -p bmm
#SBATCH -A ctbrowngrp
#SBATCH -o /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/run_gone_ORC7.out
#SBATCH -e /group/ctbrowngrp2/cbquinn/fox4/slurmlogs/run_gone_ORC7.err


# run replicates of the ORC7 (excluding admixed 2)

module load deprecated/plink/1.90

cd /group/ctbrowngrp3/scratch/cbquinn/fox/GONE_cp2

for i in {1..20}; do 
echo $i 

cp ORC7_filterA.ped ORC7_filterA_i${i}.ped
cp ORC7_filterA.map ORC7_filterA_i${i}.map

# make script dependent on the previous
srun script_GONE.sh ORC7_filterA_i${i}

rm ORC7_filterA_i${i}.ped
rm ORC7_filterA_i${i}.map
done


```